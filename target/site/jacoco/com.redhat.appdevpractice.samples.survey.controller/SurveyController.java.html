<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SurveyController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Feedback 360 Survey API</a> &gt; <a href="index.source.html" class="el_package">com.redhat.appdevpractice.samples.survey.controller</a> &gt; <span class="el_source">SurveyController.java</span></div><h1>SurveyController.java</h1><pre class="source lang-java linenums">package com.redhat.appdevpractice.samples.survey.controller;

import java.net.URI;
import java.util.ArrayList;
import java.util.List;

import com.redhat.appdevpractice.samples.survey.http.NewSurveyGroupResource;
import com.redhat.appdevpractice.samples.survey.http.SurveyGroupResource;
import com.redhat.appdevpractice.samples.survey.http.utils.HttpUtils;
import com.redhat.appdevpractice.samples.survey.model.SurveyGroup;
import com.redhat.appdevpractice.samples.survey.service.SurveyServiceImpl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.support.ServletUriComponentsBuilder;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;

@CrossOrigin
@RestController
public class SurveyController {

    private SurveyServiceImpl surveyService;

    @Autowired
<span class="nc" id="L35">    public SurveyController(SurveyServiceImpl surveyService) {</span>
<span class="nc" id="L36">        this.surveyService = surveyService;</span>
<span class="nc" id="L37">    }</span>

    @Operation(summary = &quot;Create a new survey group.&quot;, description = &quot;&quot;, tags = { &quot;surveygroup&quot; })
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;201&quot;, description = &quot;The survey group was created and the URL of the new resource is in the location HTTP header.&quot;), 
            @ApiResponse(responseCode = &quot;500&quot;, description = &quot;Something unexpected happened on our side.&quot;)
        })
    @PostMapping(&quot;/surveygroups&quot;)
    public ResponseEntity&lt;String&gt; createSurvey(@RequestBody NewSurveyGroupResource newSurveyGroup) {

<span class="nc" id="L47">        SurveyGroup surveyGroup = HttpUtils.convertToSurveyGroupFrom(newSurveyGroup);</span>

<span class="nc" id="L49">        surveyGroup = this.surveyService.createSurveyGroup(surveyGroup);</span>

<span class="nc" id="L51">        URI location = ServletUriComponentsBuilder.fromCurrentRequest().path(&quot;/{surveyGroupId}&quot;)</span>
<span class="nc" id="L52">                .buildAndExpand(surveyGroup.getGuid()).toUri();</span>
<span class="nc" id="L53">        return ResponseEntity.created(location).build();</span>
    }

    @Operation(summary = &quot;Get all the survey groups&quot;, description = &quot;&quot;, tags = { &quot;surveygroup&quot; })
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;An array of all survey groups in the system. If no survey groups exist, an empty list.&quot;)
        })
    @GetMapping(&quot;/surveygroups&quot;)
    public List&lt;SurveyGroupResource&gt; getSurveyGroups() {
        
<span class="nc" id="L63">        List&lt;SurveyGroup&gt; surveyGroups = surveyService.getSurveyGroups();</span>
        
<span class="nc" id="L65">        List&lt;SurveyGroupResource&gt; resourceCollection = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L66">        surveyGroups.forEach(sg -&gt; resourceCollection.add(HttpUtils.convertToSurveyGroupResourceFrom(sg)));</span>
        
<span class="nc" id="L68">        return resourceCollection;</span>
    }

    @Operation(summary = &quot;Get the survey group matching the given ID.&quot;, description = &quot;&quot;, tags = { &quot;surveygroup&quot; })
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;The survey group matching the ID in the URL.&quot;),
            @ApiResponse(responseCode = &quot;401&quot;, description = &quot;A survey group with the given ID was not found.&quot;)
        })
    @GetMapping(&quot;/surveygroups/{surveyGroupId}&quot;)
    public ResponseEntity&lt;SurveyGroupResource&gt; getSurveyGroup(@PathVariable String surveyGroupId) {
        
<span class="nc" id="L79">        SurveyGroup surveyGroup = surveyService.getSurveyGroup(surveyGroupId);</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">        if (surveyGroup == null) {</span>
<span class="nc" id="L81">            return ResponseEntity.notFound().build();</span>
        }

<span class="nc" id="L84">        SurveyGroupResource resource = HttpUtils.convertToSurveyGroupResourceFrom(surveyGroup);</span>
    
<span class="nc" id="L86">        return ResponseEntity.ok().body(resource);</span>
    }

    @Operation(summary = &quot;Update the survey group.&quot;, description = &quot;&quot;, tags = { &quot;surveygroup&quot; })
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;The survey group was successfully edited.&quot;),
            @ApiResponse(responseCode = &quot;401&quot;, description = &quot;A survey group with the given ID was not found.&quot;)
        })
    @PutMapping(&quot;/surveygroups/{surveyGroupId}&quot;)
    public ResponseEntity&lt;SurveyGroupResource&gt; saveSurveyGroup(@PathVariable String surveyGroupId, 
        @RequestBody SurveyGroupResource surveyGroupResource) {
        
<span class="nc" id="L98">        SurveyGroup surveyGroup = surveyService.getSurveyGroup(surveyGroupId);</span>
        
<span class="nc bnc" id="L100" title="All 2 branches missed.">        if (surveyGroup == null) {</span>
<span class="nc" id="L101">            return ResponseEntity.notFound().build();</span>
        }

<span class="nc" id="L104">        SurveyGroup newSurveyGroup = HttpUtils.convertToSurveyGroupFrom(surveyGroupResource);</span>
<span class="nc" id="L105">        surveyGroup = surveyService.updateSurveyGroup(surveyGroup, newSurveyGroup);</span>

<span class="nc" id="L107">        SurveyGroupResource resource = HttpUtils.convertToSurveyGroupResourceFrom(surveyGroup);</span>
    
<span class="nc" id="L109">        return ResponseEntity.ok().body(resource);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>